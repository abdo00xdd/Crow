{% extends 'base.html' %}

{% block content %}
<div class="settings-container">
    <!-- Sidebar Navigation -->
    <div class="settings-sidebar">
        <div class="sidebar-header">
            <h2 class="settings-title">Settings</h2>
            <div class="user-preview">
                {% if profile.profile_picture %}
                    <img src="{{ profile.profile_picture.url }}" alt="{{ user.username }}" class="user-avatar-preview" />
                {% else %}
                    <div class="user-avatar-preview default-avatar">
                        {{ user.username|first|upper }}
                    </div>
                {% endif %}
                <div class="user-info-preview">
                    <span class="username">{{ user.username }}</span>
                    <span class="user-status">Online</span>
                </div>
            </div>
        </div>
        
        <nav class="settings-nav">
            <div class="nav-section">
                <h3 class="nav-section-title">User Settings</h3>
                <a href="#profile" class="nav-item active" data-tab="profile">
                    <i class="nav-icon">üë§</i>
                    <span>My Account</span>
                </a>
                <a href="#preferences" class="nav-item" data-tab="preferences">
                    <i class="nav-icon">‚öôÔ∏è</i>
                    <span>Meeting Preferences</span>
                </a>
                <a href="#appearance" class="nav-item" data-tab="appearance">
                    <i class="nav-icon">üé®</i>
                    <span>Appearance</span>
                </a>
            </div>
            
            <div class="nav-section">
                <h3 class="nav-section-title">Privacy & Security</h3>
                <a href="#privacy" class="nav-item" data-tab="privacy">
                    <i class="nav-icon">üîí</i>
                    <span>Privacy & Safety</span>
                </a>
                <a href="#notifications" class="nav-item" data-tab="notifications">
                    <i class="nav-icon">üîî</i>
                    <span>Notifications</span>
                </a>
            </div>
            
            <div class="nav-section">
                <h3 class="nav-section-title">Advanced</h3>
                <a href="#billing" class="nav-item" data-tab="billing">
                    <i class="nav-icon">üí≥</i>
                    <span>Subscription</span>
                </a>
                <a href="#advanced" class="nav-item" data-tab="advanced">
                    <i class="nav-icon">üîß</i>
                    <span>Advanced</span>
                </a>
            </div>
        </nav>
        
        <div class="sidebar-footer">
            <a href="{% url 'home' %}" class="back-home-btn">
                ‚Üê Back to Home
            </a>
        </div>
    </div>
    
    <!-- Main Content Area -->
    <div class="settings-main">
        <div class="settings-header">
            <h1 class="page-title" id="current-tab-title">My Account</h1>
            <div class="header-actions">
                <button type="submit" form="settings-form" class="save-btn">
                    üíæ Save Changes
                </button>
            </div>
        </div>
        
        <form method="post" enctype="multipart/form-data" id="settings-form" class="settings-form">
            {% csrf_token %}
            
            <!-- Profile Tab -->
            <div class="settings-tab active" id="profile-tab">
                <div class="settings-card">
                    <h2 class="card-title">User Profile</h2>
                    <p class="card-subtitle">Customize how you appear to others</p>
                    
                    <div class="profile-section">
                        <div class="avatar-upload">
                            <div class="avatar-preview">
                                {% if profile.profile_picture %}
                                    <img src="{{ profile.profile_picture.url }}" alt="Profile" id="avatar-preview">
                                {% else %}
                                    <div class="default-avatar-large" id="avatar-preview">
                                        {{ user.username|first|upper }}
                                    </div>
                                {% endif %}
                            </div>
                            <div class="avatar-upload-controls">
                                <label class="file-upload-btn">
                                    <input type="file" name="profile_picture" accept="image/*" id="avatar-upload" hidden>
                                    <span class="btn-text">Change Avatar</span>
                                </label>
                                <button type="button" class="remove-avatar-btn">Remove</button>
                                <p class="upload-hint">JPG, PNG or GIF ‚Ä¢ Max 5MB</p>
                            </div>
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">
                                    <span class="label-text">Display Name</span>
                                    <span class="label-hint">This will be visible to other users</span>
                                </label>
                                <input type="text" class="form-input" value="{{ user.username }}" disabled>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">
                                    <span class="label-text">First Name</span>
                                </label>
                                <input type="text" name="first_name" class="form-input" value="{{ user.first_name }}" placeholder="Enter your first name">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">
                                    <span class="label-text">Last Name</span>
                                </label>
                                <input type="text" name="last_name" class="form-input" value="{{ user.last_name }}" placeholder="Enter your last name">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">
                                    <span class="label-text">Email Address</span>
                                    <span class="label-hint">Used for account notifications</span>
                                </label>
                                <input type="email" name="email" class="form-input" value="{{ user.email }}" placeholder="email@example.com">
                            </div>
                            
                            <div class="form-group full-width">
                                <label class="form-label">
                                    <span class="label-text">About Me</span>
                                    <span class="label-hint">Tell others about yourself</span>
                                </label>
                                <textarea name="bio" class="form-textarea" rows="3" placeholder="Write something about yourself...">{{ profile.bio }}</textarea>
                                <div class="char-count"><span id="bio-chars">0</span>/200</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-card">
                    <h2 class="card-title">Account Security</h2>
                    <div class="form-group">
                        <label class="form-label">Change Password</label>
                        <a href="#" class="change-password-btn">Change Password</a>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Two-Factor Authentication</label>
                        <div class="toggle-group">
                            <span class="toggle-label">Enable 2FA</span>
                            <label class="toggle-switch">
                                <input type="checkbox">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Preferences Tab -->
            <div class="settings-tab" id="preferences-tab">
                <div class="settings-card">
                    <h2 class="card-title">Meeting Preferences</h2>
                    <p class="card-subtitle">Customize your default meeting settings</p>
                    
                    <div class="preferences-grid">
                        <div class="preference-item">
                            <div class="preference-info">
                                <h4 class="preference-title">Join with video</h4>
                                <p class="preference-desc">Automatically enable your video when joining meetings</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" name="default_join_with_video" {% if profile.default_join_with_video %}checked{% endif %}>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="preference-item">
                            <div class="preference-info">
                                <h4 class="preference-title">Mute on join</h4>
                                <p class="preference-desc">Automatically mute your microphone when joining meetings</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" name="default_mute_on_join" {% if profile.default_mute_on_join %}checked{% endif %}>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="preference-item">
                            <div class="preference-info">
                                <h4 class="preference-title">Show meeting controls</h4>
                                <p class="preference-desc">Always show meeting controls panel</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="preference-item">
                            <div class="preference-info">
                                <h4 class="preference-title">Enable noise cancellation</h4>
                                <p class="preference-desc">Reduce background noise automatically</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="settings-card">
                    <h2 class="card-title">Audio & Video Settings</h2>
                    <div class="form-group">
                        <label class="form-label">Default Microphone</label>
                        <select class="form-select">
                            <option>Default System Microphone</option>
                            <option>External Microphone</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Default Camera</label>
                        <select class="form-select">
                            <option>Default System Camera</option>
                            <option>External Webcam</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- Add other tabs similarly -->
            
            <div class="settings-footer">
                <button type="submit" class="save-btn primary">
                    üíæ Save Changes
                </button>
                <a href="{% url 'home' %}" class="cancel-btn">
                    Cancel
                </a>
                <a href="#" class="danger-link">
                    Delete Account
                </a>
            </div>
        </form>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Tab switching
    const navItems = document.querySelectorAll('.nav-item');
    const tabs = document.querySelectorAll('.settings-tab');
    const currentTabTitle = document.getElementById('current-tab-title');
    
    // Tab titles mapping
    const tabTitles = {
        'profile': 'My Account',
        'preferences': 'Meeting Preferences',
        'appearance': 'Appearance',
        'privacy': 'Privacy & Safety',
        'notifications': 'Notifications',
        'billing': 'Subscription',
        'advanced': 'Advanced Settings'
    };
    
    navItems.forEach(item => {
        item.addEventListener('click', function(e) {
            e.preventDefault();
            const tabId = this.getAttribute('data-tab');
            
            // Update active nav item
            navItems.forEach(nav => nav.classList.remove('active'));
            this.classList.add('active');
            
            // Show selected tab
            tabs.forEach(tab => {
                tab.classList.remove('active');
                if (tab.id === `${tabId}-tab`) {
                    tab.classList.add('active');
                }
            });
            
            // Update page title
            if (tabTitles[tabId]) {
                currentTabTitle.textContent = tabTitles[tabId];
            }
            
            // Update URL hash
            window.location.hash = tabId;
        });
    });
    
    // Avatar upload preview
    const avatarUpload = document.getElementById('avatar-upload');
    const avatarPreview = document.getElementById('avatar-preview');
    
    if (avatarUpload) {
        avatarUpload.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    if (avatarPreview.tagName === 'IMG') {
                        avatarPreview.src = e.target.result;
                    } else {
                        // Replace div with img
                        const img = document.createElement('img');
                        img.src = e.target.result;
                        img.alt = "Profile";
                        img.className = "avatar-preview-img";
                        avatarPreview.parentNode.replaceChild(img, avatarPreview);
                        avatarPreview = img;
                    }
                };
                reader.readAsDataURL(file);
            }
        });
    }
    
    // Bio character counter
    const bioTextarea = document.querySelector('textarea[name="bio"]');
    const bioChars = document.getElementById('bio-chars');
    
    if (bioTextarea && bioChars) {
        bioTextarea.addEventListener('input', function() {
            bioChars.textContent = this.value.length;
        });
        // Initialize count
        bioChars.textContent = bioTextarea.value.length;
    }
    
    // Remove avatar button
    const removeAvatarBtn = document.querySelector('.remove-avatar-btn');
    if (removeAvatarBtn) {
        removeAvatarBtn.addEventListener('click', function() {
            if (confirm('Are you sure you want to remove your profile picture?')) {
                avatarUpload.value = '';
                if (avatarPreview.tagName === 'IMG') {
                    const defaultAvatar = document.createElement('div');
                    defaultAvatar.className = 'default-avatar-large';
                    defaultAvatar.textContent = '{{ user.username|first|upper }}';
                    avatarPreview.parentNode.replaceChild(defaultAvatar, avatarPreview);
                    avatarPreview = defaultAvatar;
                }
            }
        });
    }
    
    // Handle URL hash on load
    const hash = window.location.hash.substring(1);
    if (hash && tabTitles[hash]) {
        const targetTab = document.querySelector(`.nav-item[data-tab="${hash}"]`);
        if (targetTab) {
            targetTab.click();
        }
    }
});
</script>
{% endblock %}